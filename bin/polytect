#!/usr/bin/env bash
set -e
export POLYTECT_DIR=$(cd $(dirname $(dirname $0)) && pwd)
export NCORES=$(nproc --all)

cli_help() {
  cli_name=${0##*/}
  echo "Usage: $cli_name [command]
Commands:
  setup_tools	Setup required tools
  make_refs	Make all required reference files
  make_mats	Similate haplotyping matrices
  *		Help
"
  exit 1
}

TOOLS_VER=1.0.0
REFS_VER=1.0.0
COMMAND_ARGS=${@#"$1"}
case "$1" in
    setup_tools|t)
        tar -xvf $POLYTECT_DIR/resources/tools-$TOOLS_VER.tar.gz -C $POLYTECT_DIR/build
        bash $POLYTECT_DIR/build/tools-$TOOLS_VER/setup-tools.sh
        ;;
    make_refs|r)
        tar --strip 1 -xf $POLYTECT_DIR/resources/hs-hg38-$REFS_VER.tar.gz -C $POLYTECT_DIR/refs
        snakemake \
            --configfile $POLYTECT_DIR/config/hs-hg38-hla.yaml \
            --snakefile $POLYTECT_DIR/pipelines/make_refs.smk \
            --directory $POLYTECT_DIR \
            --cores $NCORES
        ;;
    *)
        cli_help
        ;;
esac
